<!DOCTYPE html>
<html>
<head>
  <title>Simple Frontend</title>
</head>
<body>
  <input type="text" id="repositoryUrl" placeholder="Enter repository URL">
  <button id="cloneRepository">Clone Repository</button><br><br>
  <textarea id="output" rows="10" cols="50" readonly></textarea><br>
  <button id="clearOutput">Clear Output</button>

  <script>
    const output = document.getElementById("output");
    const clearButton = document.getElementById("clearOutput");
    const cloneButton = document.getElementById("cloneRepository");

    cloneButton.addEventListener("click", function() {
      const repoUrl = document.getElementById("repositoryUrl").value;
      fetch("/clone?repo_url=" + encodeURIComponent(repoUrl), {
        method: "GET",
      })
      .then(response => response.text())
      .then(result => {
        appendToOutput("Clone result: " + result);
        document.getElementById("repositoryUrl").value = "";
      })
      .catch(error => {
        appendToOutput("Error cloning: " + error);
      });
    });

    function appendToOutput(message) {
      output.value += message + "\n";
      output.scrollTop = output.scrollHeight; // Auto-scroll
    }

    clearButton.addEventListener("click", function() {
      output.value = "";
    });

    const socket = new WebSocket('ws://localhost:8080/ws');

        socket.addEventListener('open', function (event) {
            console.log('WebSocket connected. Sending request to /mutation-test');
            // Send a request to the backend to start the mutation tests
            socket.send(JSON.stringify({ type: "start_mutation_test" })); 
            // You might need to adjust the message format based on your backend's expectations.
            //  If your backend simply starts upon connection, this line might not be needed,
            //  or the message content might be different (e.g., an empty object: {}).
            //  Refer to your backend implementation for the correct way to trigger the tests via the websocket.

        });

        socket.addEventListener('message', function (event) {
            appendToOutput(event);
        });

        socket.addEventListener('close', function (event) {
            console.log('WebSocket disconnected.');
        });
  </script>
</body>
</html>